<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Experimental Design and Simulation • simrel</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Experimental Design and Simulation">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simrel</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mbrdsim.html">Experimental Design and Simulation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/simulatr/simrel">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://simulatr.github.io/simrel">
    <span class="fa fa-globe fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Experimental Design and Simulation</h1>
                        <h4 class="author">Raju Rimal</h4>
            
            <h4 class="date">2018-10-04</h4>
      
      
      <div class="hidden name"><code>mbrdsim.Rmd</code></div>

    </div>

    
    
<div id="loading-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-packages" class="anchor"></a>Loading Packages</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(simrel)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(pls)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(ggplot2)</a></code></pre></div>
</div>
<div id="setting-up-parameters-list" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-parameters-list" class="anchor"></a>Setting up parameters list</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">sim_list &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">    <span class="dt">p =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">150</span>),</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="dt">gamma =</span> <span class="kw">seq</span>(<span class="fl">0.2</span>, <span class="fl">1.1</span>, <span class="dt">length.out =</span> <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    <span class="dt">relpos =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)), <span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>))),</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">    <span class="dt">R2 =</span> <span class="kw">list</span>(<span class="kw">c</span>(<span class="fl">0.4</span>, <span class="fl">0.8</span>), <span class="kw">c</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>)),</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    <span class="dt">ypos =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)), <span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  )</a></code></pre></div>
<p><code>mbrdsim</code> function in simrel lets user to create a factorial fractional design from the parameter list. From the <code>sim_list</code> defined above, we have two levels of “number of variables (p)”, four level of multicollineary level controlled by <code>gamma</code>. In addition, two levels of positions of relevant components and coefficient of determination are also defined. Further, we have set up two way to combine the response components. We have two informative dimension of response at first and second components. In one level, we combined the uninformative component three with first component and in another level, we combine it with second component. The additional parameters for simulation are fixed as follows,</p>
</div>
<div id="experimental-design" class="section level2">
<h2 class="hasAnchor">
<a href="#experimental-design" class="anchor"></a>Experimental Design</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">design &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mbrdsim.html">mbrdsim</a></span>(sim_list, <span class="dt">fraction =</span> <span class="dv">3</span>)[[<span class="st">"Design"</span>]]</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  design &lt;-<span class="st"> </span><span class="kw">cbind</span>(</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    design,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="dt">q =</span> <span class="kw">lapply</span>(design[, <span class="st">"p"</span>], <span class="cf">function</span>(x) <span class="kw">rep</span>(x<span class="op">/</span><span class="dv">2</span>, <span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="dt">type =</span> <span class="st">"multivariate"</span>,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="dt">n =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    <span class="dt">ntest =</span> <span class="dv">200</span>,</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="dt">m =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    <span class="dt">eta =</span> <span class="fl">0.6</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  )</a></code></pre></div>
<p>From the simulation parameters in each row of <code>design</code> table, we run our simulation.</p>
</div>
<div id="simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">sobj &lt;-<span class="st"> </span><span class="kw">apply</span>(design, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">do.call</span>(simrel, x))</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="kw">names</span>(sobj) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"Design"</span>, <span class="kw">seq.int</span>(sobj))</a></code></pre></div>
<p>Now we have eight datasets with distict properties as we have desired. We can now use these datasets in order to compare PCR and PLS estimation methods.</p>
</div>
<div id="comparison-of-estimation-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-of-estimation-methods" class="anchor"></a>Comparison of Estimation Methods</h2>
<p>The estimation methods we have used here is PCR and PLS. Now we can fit each of our data using PCR and PLS method.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  fit<span class="op">$</span>pcr &lt;-<span class="st"> </span><span class="kw">lapply</span>(sobj, <span class="cf">function</span>(obj) {</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    dta &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">I</span>(obj<span class="op">$</span>X), <span class="dt">y =</span> <span class="kw">I</span>(obj<span class="op">$</span>Y))</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    <span class="kw"><a href="http://www.rdocumentation.org/packages/pls/topics/mvr">pcr</a></span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> dta, <span class="dt">validation =</span> <span class="st">"CV"</span>, <span class="dt">segments =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  })</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  fit<span class="op">$</span>pls &lt;-<span class="st"> </span><span class="kw">lapply</span>(sobj, <span class="cf">function</span>(obj) {</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">    dta &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">I</span>(obj<span class="op">$</span>X), <span class="dt">y =</span> <span class="kw">I</span>(obj<span class="op">$</span>Y))</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">    <span class="kw"><a href="http://www.rdocumentation.org/packages/pls/topics/mvr">plsr</a></span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> dta, <span class="dt">validation =</span> <span class="st">"CV"</span>, <span class="dt">segments =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  })</a></code></pre></div>
<div id="calculating-rmsep" class="section level3">
<h3 class="hasAnchor">
<a href="#calculating-rmsep" class="anchor"></a>Calculating RMSEP</h3>
<p>We base our comparison on the basis of root mean square error of prediction. We can calculate and compare both cross-validated and test error.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">rmsep &lt;-<span class="st"> </span><span class="kw">lapply</span>(fit, <span class="cf">function</span>(f){</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">    <span class="kw">sapply</span>(<span class="kw">names</span>(f), <span class="cf">function</span>(d){</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">      new_data &lt;-<span class="st"> </span><span class="kw">with</span>(sobj[[d]], <span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">I</span>(testX), <span class="dt">y =</span> <span class="kw">I</span>(testY)))</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">      out &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/pls/topics/mvrVal">RMSEP</a></span>(f[[d]], <span class="dt">newdata =</span> new_data, <span class="dt">estimate =</span> <span class="st">"all"</span>)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">      reshape2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/reshape2/topics/melt">melt</a></span>(out[[<span class="st">"val"</span>]])</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">    }, <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  })</a></code></pre></div>
</div>
</div>
<div id="plotting-rmsep" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-rmsep" class="anchor"></a>Plotting RMSEP</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">get_error_plot &lt;-<span class="st"> </span><span class="cf">function</span>(dgn){</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">    df &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, <span class="kw">lapply</span>(rmsep, <span class="st">"[["</span>, dgn))</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    df<span class="op">$</span>method &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">.[0-9]+"</span>, <span class="st">""</span>, <span class="kw">rownames</span>(df))</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="kw">rownames</span>(df) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    df<span class="op">$</span>model &lt;-<span class="st"> </span><span class="kw">ifelse</span>(df<span class="op">$</span>model <span class="op">==</span><span class="st"> "(Intercept)"</span>, <span class="st">"0"</span>, df<span class="op">$</span>model)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    df<span class="op">$</span>model &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">"[A-Za-z]+"</span>, <span class="st">""</span>, df<span class="op">$</span>model))</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">    <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(df, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(model, value, <span class="dt">color =</span> estimate, <span class="dt">group =</span> estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">      </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="st">      </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_grid">facet_grid</a></span>(response <span class="op">~</span><span class="st"> </span>method, <span class="dt">scales =</span> <span class="st">"free_y"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="st">      </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"top"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="st">      </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">x =</span> <span class="st">"Predictors"</span>, <span class="dt">y =</span> <span class="st">"RMSEP"</span>, <span class="dt">color =</span> <span class="st">"Estimate"</span>)</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">  }</a></code></pre></div>
<p>The above function, can plot prediction error (RMSEP) from both estimation methods for all three response variables. Lets plot the error for first and second design,</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">get_error_plot</span>(<span class="dv">1</span>)</a></code></pre></div>
<p><img src="mbrdsim_files/figure-html/unnamed-chunk-8-1.svg" width="90%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">get_error_plot</span>(<span class="dv">2</span>)</a></code></pre></div>
<p><img src="mbrdsim_files/figure-html/unnamed-chunk-8-2.svg" width="90%" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#loading-packages">Loading Packages</a></li>
      <li><a href="#setting-up-parameters-list">Setting up parameters list</a></li>
      <li><a href="#experimental-design">Experimental Design</a></li>
      <li><a href="#simulation">Simulation</a></li>
      <li><a href="#comparison-of-estimation-methods">Comparison of Estimation Methods</a></li>
      <li><a href="#plotting-rmsep">Plotting RMSEP</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://mathatistics.com">Raju Rimal</a>, <a href="http://solvsa.nmbu.no">Solve Sæbø</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
